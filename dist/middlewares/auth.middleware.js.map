{"version":3,"file":"auth.middleware.js","names":["jwt","JWT_SECRET","verifyToken","req","res","next","authHeader","headers","startsWith","status","json","message","token","split","decoded","verify","id","console","warn","user","log","error","name"],"sources":["../../src/middlewares/auth.middleware.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = 'Xpto-secret0-key';\r\n\r\nexport const verifyToken = (req, res, next) => {\r\n  try {\r\n    const authHeader = req.headers['authorization'];\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n      return res.status(403).json({ message: 'Token de autenticación no proporcionado o formato incorrecto.' });\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    if (!token) {\r\n      return res.status(403).json({ message: 'Token de autenticación no encontrado.' });\r\n    }\r\n\r\n    const decoded = jwt.verify(token, JWT_SECRET);\r\n    \r\n    if (!decoded.id) {\r\n      console.warn('Token decodificado pero sin ID de usuario:', decoded);\r\n      return res.status(401).json({ message: 'Token no contiene información válida de usuario.' });\r\n    }\r\n\r\n    req.user = decoded;\r\n    console.log('Usuario autenticado:', req.user);\r\n\r\n    next();\r\n  } catch (error) {\r\n    console.error('Error al verificar el token:', error);\r\n\r\n    if (error.name === 'TokenExpiredError') {\r\n      return res.status(401).json({ message: 'El token ha expirado.' });\r\n    } else if (error.name === 'JsonWebTokenError') {\r\n      return res.status(401).json({ message: 'Token no válido.' });\r\n    } else {\r\n      return res.status(500).json({ message: 'Error al procesar la autenticación.' });\r\n    }\r\n  }\r\n};\r\n"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAE9B,MAAMC,UAAU,GAAG,kBAAkB;AAErC,OAAO,MAAMC,WAAW,GAAGA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAC7C,IAAI;IACF,MAAMC,UAAU,GAAGH,GAAG,CAACI,OAAO,CAAC,eAAe,CAAC;IAC/C,IAAI,CAACD,UAAU,IAAI,CAACA,UAAU,CAACE,UAAU,CAAC,SAAS,CAAC,EAAE;MACpD,OAAOJ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAgE,CAAC,CAAC;IAC3G;IAEA,MAAMC,KAAK,GAAGN,UAAU,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACtC,IAAI,CAACD,KAAK,EAAE;MACV,OAAOR,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAwC,CAAC,CAAC;IACnF;IAEA,MAAMG,OAAO,GAAGd,GAAG,CAACe,MAAM,CAACH,KAAK,EAAEX,UAAU,CAAC;IAE7C,IAAI,CAACa,OAAO,CAACE,EAAE,EAAE;MACfC,OAAO,CAACC,IAAI,CAAC,4CAA4C,EAAEJ,OAAO,CAAC;MACnE,OAAOV,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAmD,CAAC,CAAC;IAC9F;IAEAR,GAAG,CAACgB,IAAI,GAAGL,OAAO;IAClBG,OAAO,CAACG,GAAG,CAAC,sBAAsB,EAAEjB,GAAG,CAACgB,IAAI,CAAC;IAE7Cd,IAAI,CAAC,CAAC;EACR,CAAC,CAAC,OAAOgB,KAAK,EAAE;IACdJ,OAAO,CAACI,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IAEpD,IAAIA,KAAK,CAACC,IAAI,KAAK,mBAAmB,EAAE;MACtC,OAAOlB,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAwB,CAAC,CAAC;IACnE,CAAC,MAAM,IAAIU,KAAK,CAACC,IAAI,KAAK,mBAAmB,EAAE;MAC7C,OAAOlB,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAmB,CAAC,CAAC;IAC9D,CAAC,MAAM;MACL,OAAOP,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAsC,CAAC,CAAC;IACjF;EACF;AACF,CAAC","ignoreList":[]}