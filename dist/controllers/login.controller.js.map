{"version":3,"file":"login.controller.js","names":["_bcrypt","_interopRequireDefault","require","_jsonwebtoken","_connection","JWT_SECRET","loginController","req","res","email","user_password","body","status","json","message","client","getConnection","result","query","rows","length","user","isMatch","bcrypt","compare","token","jwt","sign","id","user_type","expiresIn","user_name","lastname","error","console","headersSent","exports"],"sources":["../../src/controllers/login.controller.js"],"sourcesContent":["// login.controller.js\r\nimport bcrypt from 'bcrypt';\r\nimport jwt from 'jsonwebtoken';\r\nimport { getConnection } from '../database/connection.js';\r\n\r\nconst JWT_SECRET = 'Xpto-secret0-key';\r\n\r\nexport const loginController = async (req, res) => {\r\n  const { email, user_password } = req.body;\r\n\r\n  if (!email || !user_password) {\r\n    return res.status(400).json({ message: 'Email y contraseña son requeridos' });\r\n  }\r\n\r\n  try {\r\n    const client = await getConnection();\r\n    const result = await client.query('SELECT * FROM users WHERE email = $1', [email]);\r\n\r\n    if (result.rows.length === 0) {\r\n      return res.status(401).json({ message: 'Email o contraseña incorrectos' });\r\n    }\r\n\r\n    const user = result.rows[0];\r\n    const isMatch = await bcrypt.compare(user_password, user.user_password);\r\n    if (!isMatch) {\r\n      return res.status(401).json({ message: 'Email o contraseña incorrectos' });\r\n    }\r\n\r\n    const token = jwt.sign(\r\n      { id: user.id, email: user.email, user_type: user.user_type },\r\n      JWT_SECRET,\r\n      { expiresIn: '1h' }\r\n    );\r\n\r\n    res.status(200).json({\r\n      message: 'Inicio de sesión exitoso',\r\n      token,\r\n      user: {\r\n        id: user.id,\r\n        user_name: user.user_name,\r\n        lastname: user.lastname,\r\n        email: user.email,\r\n        user_type: user.user_type\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error durante el inicio de sesión:', error);\r\n    if (!res.headersSent) {\r\n      res.status(500).json({ message: 'Error interno del servidor' });\r\n    }\r\n  }\r\n};\r\n"],"mappings":";;;;;;;AACA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,aAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AAHA;;AAKA,MAAMG,UAAU,GAAG,kBAAkB;AAE9B,MAAMC,eAAe,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,KAAK;EACjD,MAAM;IAAEC,KAAK;IAAEC;EAAc,CAAC,GAAGH,GAAG,CAACI,IAAI;EAEzC,IAAI,CAACF,KAAK,IAAI,CAACC,aAAa,EAAE;IAC5B,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAAoC,CAAC,CAAC;EAC/E;EAEA,IAAI;IACF,MAAMC,MAAM,GAAG,MAAM,IAAAC,yBAAa,EAAC,CAAC;IACpC,MAAMC,MAAM,GAAG,MAAMF,MAAM,CAACG,KAAK,CAAC,sCAAsC,EAAE,CAACT,KAAK,CAAC,CAAC;IAElF,IAAIQ,MAAM,CAACE,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;MAC5B,OAAOZ,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAiC,CAAC,CAAC;IAC5E;IAEA,MAAMO,IAAI,GAAGJ,MAAM,CAACE,IAAI,CAAC,CAAC,CAAC;IAC3B,MAAMG,OAAO,GAAG,MAAMC,eAAM,CAACC,OAAO,CAACd,aAAa,EAAEW,IAAI,CAACX,aAAa,CAAC;IACvE,IAAI,CAACY,OAAO,EAAE;MACZ,OAAOd,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAiC,CAAC,CAAC;IAC5E;IAEA,MAAMW,KAAK,GAAGC,qBAAG,CAACC,IAAI,CACpB;MAAEC,EAAE,EAAEP,IAAI,CAACO,EAAE;MAAEnB,KAAK,EAAEY,IAAI,CAACZ,KAAK;MAAEoB,SAAS,EAAER,IAAI,CAACQ;IAAU,CAAC,EAC7DxB,UAAU,EACV;MAAEyB,SAAS,EAAE;IAAK,CACpB,CAAC;IAEDtB,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,0BAA0B;MACnCW,KAAK;MACLJ,IAAI,EAAE;QACJO,EAAE,EAAEP,IAAI,CAACO,EAAE;QACXG,SAAS,EAAEV,IAAI,CAACU,SAAS;QACzBC,QAAQ,EAAEX,IAAI,CAACW,QAAQ;QACvBvB,KAAK,EAAEY,IAAI,CAACZ,KAAK;QACjBoB,SAAS,EAAER,IAAI,CAACQ;MAClB;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOI,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC1D,IAAI,CAACzB,GAAG,CAAC2B,WAAW,EAAE;MACpB3B,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAA6B,CAAC,CAAC;IACjE;EACF;AACF,CAAC;AAACsB,OAAA,CAAA9B,eAAA,GAAAA,eAAA","ignoreList":[]}