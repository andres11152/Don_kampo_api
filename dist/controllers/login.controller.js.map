{"version":3,"file":"login.controller.js","names":["bcrypt","jwt","getConnection","JWT_SECRET","loginController","_ref","_asyncToGenerator","req","res","email","user_password","body","status","json","message","client","result","query","rows","length","user","isMatch","compare","token","sign","id","user_type","expiresIn","user_name","lastname","error","console","headersSent","_x","_x2","apply","arguments"],"sources":["../../src/controllers/login.controller.js"],"sourcesContent":["// login.controller.js\r\nimport bcrypt from 'bcrypt';\r\nimport jwt from 'jsonwebtoken';\r\nimport { getConnection } from '../database/connection.js';\r\n\r\nconst JWT_SECRET = 'Xpto-secret0-key';\r\n\r\nexport const loginController = async (req, res) => {\r\n  const { email, user_password } = req.body;\r\n\r\n  if (!email || !user_password) {\r\n    return res.status(400).json({ message: 'Email y contraseña son requeridos' });\r\n  }\r\n\r\n  try {\r\n    const client = await getConnection();\r\n    const result = await client.query('SELECT * FROM users WHERE email = $1', [email]);\r\n\r\n    if (result.rows.length === 0) {\r\n      return res.status(401).json({ message: 'Email o contraseña incorrectos' });\r\n    }\r\n\r\n    const user = result.rows[0];\r\n    const isMatch = await bcrypt.compare(user_password, user.user_password);\r\n    if (!isMatch) {\r\n      return res.status(401).json({ message: 'Email o contraseña incorrectos' });\r\n    }\r\n\r\n    const token = jwt.sign(\r\n      { id: user.id, email: user.email, user_type: user.user_type },\r\n      JWT_SECRET,\r\n      { expiresIn: '1h' }\r\n    );\r\n\r\n    res.status(200).json({\r\n      message: 'Inicio de sesión exitoso',\r\n      token,\r\n      user: {\r\n        id: user.id,\r\n        user_name: user.user_name,\r\n        lastname: user.lastname,\r\n        email: user.email,\r\n        user_type: user.user_type\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error durante el inicio de sesión:', error);\r\n    if (!res.headersSent) {\r\n      res.status(500).json({ message: 'Error interno del servidor' });\r\n    }\r\n  }\r\n};\r\n"],"mappings":";AAAA;AACA,OAAOA,MAAM,MAAM,QAAQ;AAC3B,OAAOC,GAAG,MAAM,cAAc;AAC9B,SAASC,aAAa,QAAQ,2BAA2B;AAEzD,MAAMC,UAAU,GAAG,kBAAkB;AAErC,OAAO,MAAMC,eAAe;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAOC,GAAG,EAAEC,GAAG,EAAK;IACjD,MAAM;MAAEC,KAAK;MAAEC;IAAc,CAAC,GAAGH,GAAG,CAACI,IAAI;IAEzC,IAAI,CAACF,KAAK,IAAI,CAACC,aAAa,EAAE;MAC5B,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAoC,CAAC,CAAC;IAC/E;IAEA,IAAI;MACF,MAAMC,MAAM,SAASb,aAAa,CAAC,CAAC;MACpC,MAAMc,MAAM,SAASD,MAAM,CAACE,KAAK,CAAC,sCAAsC,EAAE,CAACR,KAAK,CAAC,CAAC;MAElF,IAAIO,MAAM,CAACE,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;QAC5B,OAAOX,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEC,OAAO,EAAE;QAAiC,CAAC,CAAC;MAC5E;MAEA,MAAMM,IAAI,GAAGJ,MAAM,CAACE,IAAI,CAAC,CAAC,CAAC;MAC3B,MAAMG,OAAO,SAASrB,MAAM,CAACsB,OAAO,CAACZ,aAAa,EAAEU,IAAI,CAACV,aAAa,CAAC;MACvE,IAAI,CAACW,OAAO,EAAE;QACZ,OAAOb,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEC,OAAO,EAAE;QAAiC,CAAC,CAAC;MAC5E;MAEA,MAAMS,KAAK,GAAGtB,GAAG,CAACuB,IAAI,CACpB;QAAEC,EAAE,EAAEL,IAAI,CAACK,EAAE;QAAEhB,KAAK,EAAEW,IAAI,CAACX,KAAK;QAAEiB,SAAS,EAAEN,IAAI,CAACM;MAAU,CAAC,EAC7DvB,UAAU,EACV;QAAEwB,SAAS,EAAE;MAAK,CACpB,CAAC;MAEDnB,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,0BAA0B;QACnCS,KAAK;QACLH,IAAI,EAAE;UACJK,EAAE,EAAEL,IAAI,CAACK,EAAE;UACXG,SAAS,EAAER,IAAI,CAACQ,SAAS;UACzBC,QAAQ,EAAET,IAAI,CAACS,QAAQ;UACvBpB,KAAK,EAAEW,IAAI,CAACX,KAAK;UACjBiB,SAAS,EAAEN,IAAI,CAACM;QAClB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOI,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,IAAI,CAACtB,GAAG,CAACwB,WAAW,EAAE;QACpBxB,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEC,OAAO,EAAE;QAA6B,CAAC,CAAC;MACjE;IACF;EACF,CAAC;EAAA,gBA5CYV,eAAeA,CAAA6B,EAAA,EAAAC,GAAA;IAAA,OAAA7B,IAAA,CAAA8B,KAAA,OAAAC,SAAA;EAAA;AAAA,GA4C3B","ignoreList":[]}